"""
Формы Django для приложения greeting_app.

Формы используются для:
- Валидации данных, введенных пользователем
- Отображения полей ввода в HTML
- Обработки ошибок ввода
"""

from django import forms
from .models import UserName


class NameForm(forms.ModelForm):
    """
    Форма для ввода имени пользователя.
    
    Наследуется от forms.ModelForm, что позволяет автоматически
    создать форму на основе модели UserName.
    
    Эта форма:
    - Отображает поле для ввода имени
    - Валидирует данные перед сохранением
    - Обрабатывает ошибки (например, пустое поле)
    """
    
    class Meta:
        """
        Метаданные формы.
        Указывают, какая модель используется и какие поля включать.
        """
        # Модель, на основе которой создается форма
        model = UserName
        # Поля, которые будут включены в форму
        fields = ['name']
        # Можно также использовать fields = '__all__' для всех полей
    
    def __init__(self, *args, **kwargs):
        """
        Инициализация формы.
        Настраивает внешний вид и поведение полей формы.
        """
        # Вызов родительского конструктора
        super().__init__(*args, **kwargs)
        
        # Настройка поля 'name'
        # Добавление CSS класса для стилизации
        self.fields['name'].widget.attrs.update({
            'class': 'form-input',  # CSS класс для стилизации
            'placeholder': 'Введите ваше имя',  # Подсказка в поле ввода
            'autofocus': True,  # Автоматический фокус на поле при загрузке страницы
        })
        
        # Настройка метки (label) поля
        # Это текст, который отображается перед полем ввода
        self.fields['name'].label = 'Ваше имя:'
        
        # Настройка валидации поля
        # required=True означает, что поле обязательно для заполнения
        self.fields['name'].required = True
    
    def clean_name(self):
        """
        Метод для дополнительной валидации поля 'name'.
        
        Вызывается автоматически Django при проверке формы.
        Метод должен возвращать очищенное (валидное) значение.
        
        Если значение невалидно, нужно вызвать forms.ValidationError.
        """
        # Получение введенного имени
        # cleaned_data содержит уже очищенные данные формы
        name = self.cleaned_data.get('name')
        
        # Проверка на пустое значение
        # strip() удаляет пробелы в начале и конце строки
        if not name or not name.strip():
            # Вызов ошибки валидации с сообщением для пользователя
            raise forms.ValidationError(
                'Поле имени не может быть пустым. Пожалуйста, введите ваше имя.'
            )
        
        # Удаление лишних пробелов в начале и конце
        name = name.strip()
        
        # Проверка минимальной длины имени (опционально)
        if len(name) < 2:
            raise forms.ValidationError(
                'Имя должно содержать хотя бы 2 символа.'
            )
        
        # Возврат очищенного значения
        return name

